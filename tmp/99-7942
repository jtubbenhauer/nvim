local M = {
	"zbirenbaum/copilot.lua",
	dependencies = {
		"copilotlsp-nvim/copilot-lsp", -- (optional) for NES functionality
	},
	opts = {
		suggestion = {
			enabled = true,
			auto_trigger = true,
			keymap = {
				accept = "<Tab>",
				accept_word = false,
				accept_line = false,
				next = "<M-]>",
				prev = "<M-[>",
				dismiss = "<C-]>",
			},
		},
		panel = { enabled = false },
	},
	config = function(_, opts)
		require("copilot").setup(opts)
		
		-- Ensure Tab accepts copilot suggestion when visible
		vim.keymap.set("i", "<Tab>", function()
			if require("copilot.suggestion").is_visible() then
				require("copilot.suggestion").accept()
			else
				return "<Tab>"
			end
		end, { expr = true, silent = true })
	end,
	cmd = "Copilot",
	event = "InsertEnter",
}

return M
